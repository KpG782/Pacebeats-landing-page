---
import HowClient from './client/HowClient';
---

<section 
    id="how-it-works" 
    class="bg-black text-white py-20 px-6"
    aria-labelledby="how-heading"
    itemscope 
    itemtype="https://schema.org/HowTo"
>
    <div class="max-w-7xl mx-auto">
        <!-- Section Header with enhanced SEO -->
        <header class="text-center mb-16">
            <h2 
                id="how-heading" 
                class="text-4xl md:text-5xl lg:text-6xl font-black text-white font-inter leading-tight mb-4"
                itemprop="name"
            >
                How It Works
            </h2>
            <p 
                class="text-gray-300 text-lg md:text-xl max-w-3xl mx-auto leading-relaxed"
                itemprop="description"
            >
                From setup to your first run - see how Pacebeats transforms your running experience into the ultimate music-synchronized workout companion.
            </p>
            <div class="sr-only">
                <p>Complete step-by-step guide to using Pacebeats running app with music synchronization, pace tracking, and community features</p>
            </div>
        </header>

        <!-- Interactive Music Recommendation Flow -->
        <HowClient client:load />

        <!-- Development Status Notice -->
        <section class="mt-16 text-center" role="region" aria-label="Development status information">
            <div class="bg-gray-900 p-8 rounded-2xl border border-gray-800 max-w-4xl mx-auto">
                <header class="flex items-center justify-center mb-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-4" aria-hidden="true">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" focusable="false">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-white font-inter">Currently in Development</h3>
                </header>
                <p class="text-gray-300 text-lg leading-relaxed mb-6">
                    Pacebeats is being actively developed by our passionate team. Each feature is being crafted with precision to deliver the best running experience.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center" role="list" aria-label="Development phases">
                    <div class="bg-gray-800 p-4 rounded-lg" role="listitem">
                        <h4 class="text-blue-400 font-semibold mb-2">Phase 1</h4>
                        <p class="text-gray-400 text-sm">Core tracking & watch connectivity</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg" role="listitem">
                        <h4 class="text-purple-400 font-semibold mb-2">Phase 2</h4>
                        <p class="text-gray-400 text-sm">Advanced analytics & insights</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg" role="listitem">
                        <h4 class="text-green-400 font-semibold mb-2">Phase 3</h4>
                        <p class="text-gray-400 text-sm">Community features & challenges</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hidden content for SEO -->
        <div class="sr-only">
            <h3>Complete Pacebeats Workflow</h3>
            <p>Learn how to use Pacebeats running app step by step, from initial setup to community engagement</p>
            <meta itemprop="totalTime" content="PT10M" />
            <meta itemprop="prepTime" content="PT2M" />
            <meta itemprop="performTime" content="PT8M" />
            <span>Estimated time: 10 minutes</span>
            <span>Setup time: 2 minutes</span>
            <span>Usage time: 8 minutes</span>
        </div>
    </div>
</section>

<!-- JSON-LD Structured Data for How-To Guide -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Use Pacebeats Running App",
    "description": "Complete step-by-step guide to using Pacebeats for music-synchronized running with pace tracking and community features",
    "totalTime": "PT10M",
    "prepTime": "PT2M", 
    "performTime": "PT8M",
    "estimatedCost": {
        "@type": "MonetaryAmount",
        "currency": "USD",
        "value": "0"
    },
    "supply": [
        {
            "@type": "HowToSupply",
            "name": "Smartphone with Pacebeats app"
        },
        {
            "@type": "HowToSupply", 
            "name": "Running shoes and attire"
        },
        {
            "@type": "HowToSupply",
            "name": "Spotify account (optional)"
        }
    ],
    "step": [
        {
            "@type": "HowToStep",
            "position": 1,
            "name": "Set Target Pace & Playlist",
            "text": "Pick your target pace and select your playlist. Pacebeats intelligently syncs music tempo to your running rhythm.",
            "url": "https://www.pacebeats.top/#how-it-works"
        },
        {
            "@type": "HowToStep",
            "position": 2,
            "name": "Start Running & Auto-Sync", 
            "text": "Start your run and let Pacebeats automatically match song tempo to your running cadence in real-time.",
            "url": "https://www.pacebeats.top/#how-it-works"
        },
        {
            "@type": "HowToStep",
            "position": 3,
            "name": "Smart Music Recommendations",
            "text": "Receive intelligent song recommendations based on your pace preferences. Like or skip tracks to refine the algorithm.",
            "url": "https://www.pacebeats.top/#how-it-works"
        },
        {
            "@type": "HowToStep",
            "position": 4,
            "name": "View Analytics Dashboard",
            "text": "Access comprehensive performance insights with historical tracking and detailed progress visualization.",
            "url": "https://www.pacebeats.top/#how-it-works"
        },
        {
            "@type": "HowToStep",
            "position": 5,
            "name": "Connect & Share with Community",
            "text": "Join the running community, share achievements, participate in challenges, and motivate each other.",
            "url": "https://www.pacebeats.top/#how-it-works"
        }
    ],
    "about": {
        "@type": "SoftwareApplication",
        "name": "Pacebeats",
        "applicationCategory": "HealthApplication"
    }
}
</script>

<style>
    /* Inter font consistency */
    .font-inter {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        letter-spacing: -0.025em;
    }
    
    /* Step card hover effects */
    .group:hover .bg-gray-900 {
        transform: translateY(-4px);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    
    /* Step number animation */
    .group:hover .w-12.h-12 {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
    }
    
    /* Icon hover effects */
    .group:hover .w-16.h-16 {
        transform: scale(1.05);
    }
    
    /* Connection line animation */
    @keyframes flowingGradient {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    
    .bg-gradient-to-r {
        background-size: 200% 200%;
        animation: flowingGradient 3s ease infinite;
    }
    
    /* Status badge animations */
    .bg-blue-900 {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }
    
    /* Responsive adjustments */
    @media (max-width: 1024px) {
        .bg-gradient-to-r {
            display: none;
        }
    }
    
    @media (max-width: 768px) {
        .text-4xl.md\\:text-5xl.lg\\:text-6xl {
            font-size: 2.5rem;
        }
        
        .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-5 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }
    }
    
    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
        .group:hover .bg-gray-900,
        .group:hover .w-12.h-12,
        .group:hover .w-16.h-16 {
            transform: none;
        }
        
        .bg-gradient-to-r {
            animation: none;
        }
        
        .bg-blue-900 {
            animation: none;
        }
    }
    
    /* Focus styles for keyboard navigation */
    .group:focus-within .bg-gray-900 {
        outline: 2px solid #3B82F6;
        outline-offset: 2px;
    }
    
    /* Enhanced staggered animation for step cards */
    .step-card {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
        transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        will-change: transform, opacity;
    }

    .step-card.animate-in {
        opacity: 1;
        transform: translateY(0) scale(1);
    }

    /* Progressive delays for staggered effect */
    .step-card[data-step="1"] {
        transition-delay: 0ms;
    }

    .step-card[data-step="2"] {
        transition-delay: 150ms;
    }

    .step-card[data-step="3"] {
        transition-delay: 300ms;
    }

    .step-card[data-step="4"] {
        transition-delay: 450ms;
    }

    .step-card[data-step="5"] {
        transition-delay: 600ms;
    }

    /* Enhanced accessibility styles */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* Enhanced focus styles */
    article:focus-visible {
        outline: 3px solid rgba(59, 130, 246, 0.8);
        outline-offset: 4px;
        transform: translateY(-4px) scale(1.02);
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
        .step-card article {
            border: 2px solid #ffffff;
        }
        
        .text-gray-300,
        .text-gray-400 {
            color: #ffffff;
        }
        
        [role="status"] {
            border: 1px solid #ffffff;
        }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        .step-card {
            transition: none;
            opacity: 1;
            transform: none;
        }
        
        .group:hover .bg-gray-900,
        .group:hover .w-12.h-12,
        .group:hover .w-16.h-16 {
            transform: none;
        }
        
        .bg-gradient-to-r {
            animation: none;
        }
        
        .bg-blue-900 {
            animation: none;
        }
    }
</style>

<script>
    // Enhanced intersection observer for staggered step animations
    if ('IntersectionObserver' in window) {
        const howObserver = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const step = entry.target.getAttribute('data-step');
                    const delay = parseInt(step || '1') * 150;
                    
                    setTimeout(() => {
                        entry.target.classList.add('animate-in');
                        
                        // Announce to screen readers for the first step
                        if (step === '1') {
                            const announcement = document.createElement('div');
                            announcement.setAttribute('aria-live', 'polite');
                            announcement.className = 'sr-only';
                            announcement.textContent = 'How it works section has loaded with 5 steps';
                            document.body.appendChild(announcement);
                            
                            setTimeout(() => {
                                if (document.body.contains(announcement)) {
                                    document.body.removeChild(announcement);
                                }
                            }, 2000);
                        }
                    }, delay);
                }
            });
        }, {
            threshold: 0.2,
            rootMargin: '50px'
        });
        
        // Observe all step cards
        document.querySelectorAll('.step-card').forEach(card => {
            howObserver.observe(card);
        });
    }
    
    // Enhanced keyboard navigation for step cards
    document.querySelectorAll('[role="article"]').forEach(article => {
        const handleKeydown = (e: KeyboardEvent) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                
                // Get step information
                const stepTitle = article.querySelector('h3')?.textContent;
                const stepDesc = article.querySelector('p')?.textContent;
                
                // Announce step details to screen readers
                const announcement = document.createElement('div');
                announcement.setAttribute('aria-live', 'assertive');
                announcement.className = 'sr-only';
                announcement.textContent = `Selected: ${stepTitle}. ${stepDesc}`;
                document.body.appendChild(announcement);
                
                setTimeout(() => {
                    if (document.body.contains(announcement)) {
                        document.body.removeChild(announcement);
                    }
                }, 3000);
            }
        };
        
        (article as HTMLElement).addEventListener('keydown', handleKeydown);
    });
    
    // Performance optimization: Preload next section
    if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
            const preloadImages = ['/tech-stack-preview.jpg'];
            preloadImages.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        });
    }
</script>